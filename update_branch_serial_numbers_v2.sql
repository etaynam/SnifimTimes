-- Supabase/Postgres migration for serial_number updates
-- Direct update approach (avoiding NULL due to NOT NULL constraint)
-- Empty values are kept as '0' exactly

BEGIN;

-- Update from inline mapping
WITH mapping(branch_number_txt, serial_txt) AS (
  VALUES
  ('1', '617'),
  ('11', '627'),
  ('15', '618'),
  ('16', '679'),
  ('18', '681'),
  ('20', '630'),
  ('26', '619'),
  ('30', '620'),
  ('35', '638'),
  ('36', '645'),
  ('40', '621'),
  ('41', '639'),
  ('44', '0'),
  ('45', '4523'),
  ('50', '622'),
  ('51', '623'),
  ('52', '639'),
  ('54', '631'),
  ('55', '4425'),
  ('60', '632'),
  ('65', '633'),
  ('66', '641'),
  ('71', '647'),
  ('72', '634'),
  ('75', '0'),
  ('76', '642'),
  ('77', '643'),
  ('78', '636'),
  ('80', '680'),
  ('81', '625'),
  ('82', '626'),
  ('83', '0'),
  ('91', '0'),
  ('98', '637'),
  ('202', '628'),
  ('203', '667'),
  ('205', '668'),
  ('207', '669'),
  ('211', '657'),
  ('212', '0'),
  ('217', '672'),
  ('218', '673'),
  ('220', '674'),
  ('222', '675'),
  ('223', '676'),
  ('230', '677'),
  ('238', '658'),
  ('239', '648'),
  ('241', '644'),
  ('242', '678'),
  ('244', '659'),
  ('245', '660'),
  ('246', '661'),
  ('247', '649'),
  ('250', '650'),
  ('260', '645'),
  ('261', '662'),
  ('262', '663'),
  ('263', '654'),
  ('264', '652'),
  ('265', '0'),
  ('267', '664'),
  ('268', '665'),
  ('274', '646'),
  ('277', '629'),
  ('289', '666'),
  ('290', '656')
)
UPDATE public.branches b
SET serial_number = CASE
    WHEN m.serial_txt = '' THEN '0'          -- blank -> '0' (due to NOT NULL constraint)
    ELSE m.serial_txt                         -- '0' and any other value applied as-is
END
FROM mapping m
WHERE b.branch_number = m.branch_number_txt;

-- Verification query (uncomment to see results)
-- SELECT branch_name, branch_number, serial_number
-- FROM public.branches
-- WHERE branch_number IN ('1', '11', '15', '16', '18', '20', '26', '30', '35', '36', '40', '41', '44', '45', '50', '51', '52', '54', '55', '60', '65', '66', '71', '72', '75', '76', '77', '78', '80', '81', '82', '83', '91', '98', '202', '203', '205', '207', '211', '212', '217', '218', '220', '222', '223', '230', '238', '239', '241', '242', '244', '245', '246', '247', '250', '260', '261', '262', '263', '264', '265', '267', '268', '274', '277', '289', '290')
-- ORDER BY branch_number;

COMMIT;
